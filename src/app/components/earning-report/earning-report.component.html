<p-toast></p-toast>
<p-progressSpinner *ngIf="loading"></p-progressSpinner>

<p-toolbar styleClass="p-mr-2">
  <ng-template pTemplate="left">
  </ng-template>

  <ng-template pTemplate="right">
    <div class="row">
    <div class="col-md-12">
      <label for="searchDate">Date: </label>
      <p-calendar [(ngModel)]="searchDate" [showIcon]="true" inputId="icon"></p-calendar>
      <button pButton pRipple label="Search" icon="pi pi-search" class="p-button-warning p-mr-2" (click)="searchRecords()"></button>
    </div>
  </div>
  </ng-template>
</p-toolbar>


<div class="card">
  <p-table
    #dt1
    [value]="earningReports"
    styleClass="p-datatable-gridlines p-datatable-lg"
    [loading]="loading"
    [showCurrentPageReport]="true"
	  [globalFilterFields]="['company','currentQuarter']">
  >
    <ng-template pTemplate="header">
      <tr>
        <th colspan="11">
          <input #box pInputText type="text" (input)="dt1.filterGlobal(box.value, 'contains')" placeholder="Search keyword" />
        </th>
      </tr>
      <tr>
        <th pSortableColumn="date">Date<p-sortIcon field="date"></p-sortIcon></th>
        <th pSortableColumn="year">Year<p-sortIcon field="year"></p-sortIcon></th>
        <th pSortableColumn="company">Company<p-sortIcon field="company"></p-sortIcon></th>
        <th pSortableColumn="currentQuarter">Current Quarter<p-sortIcon field="currentQuarter"></p-sortIcon></th>
        <th pSortableColumn="qoQSales_Q1">Sales(QoQ)<p-sortIcon field="qoQSales_Q1"></p-sortIcon></th>
        <th pSortableColumn="yoYSales_Q1">Sales(YoY)<p-sortIcon field="yoYSales_Q1"></p-sortIcon></th>
        <th pSortableColumn="qoQNetProfit_Q1" >Gross Profit(QoQ)<p-sortIcon field="qoQNetProfit_Q1"></p-sortIcon></th>
        <th pSortableColumn="yoYNetProfit_Q1">Gross Profit(YoY)<p-sortIcon field="yoYNetProfit_Q1"></p-sortIcon></th>
        <th pSortableColumn="qoQGrossProfit_Q1" >Net Profit(QoQ)<p-sortIcon field="qoQGrossProfit_Q1"></p-sortIcon></th>
        <th pSortableColumn="yoYGrossProfit_Q1">Net Profit(YoY)<p-sortIcon field="yoYGrossProfit_Q1"></p-sortIcon></th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-earningReport let-rowIndex="rowIndex">
      <tr>
        <td> {{ earningReport.date | date: "yyyy-MM-dd" }}</td>
        <td> {{ earningReport.year }}</td>
        <td style="cursor: pointer; text-decoration: underline;">
        <span (click)= "showStock(earningReport.company)">{{ earningReport.company }}</span>
        <button pButton pRipple type="button"
        icon="pi pi-chart-bar"
        class="p-button-rounded p-button-secondary p-button-text"
        (click)="openChart(earningReport.company)">
        </button>
      </td>
        <td> {{ earningReport.currentQuarter }}</td>

        <td [ngClass]="{ positive: earningReport.qoQSales_Q1 > 0, negative: earningReport.qoQSales_Q1 < 0 }"> {{ earningReport.qoQSales_Q1}} </td>
        <td [ngClass]="{ positive: earningReport.yoYSales_Q1 > 0, negative: earningReport.yoYSales_Q1 < 0 }">  {{ earningReport.yoYSales_Q1}} </td>

        <td [ngClass]="{ positive: earningReport.qoQGrossProfit_Q1 > 0, negative: earningReport.qoQGrossProfit_Q1 < 0 }">  {{ earningReport.qoQGrossProfit_Q1}} </td>
        <td [ngClass]="{ positive: earningReport.yoYGrossProfit_Q1 > 0, negative: earningReport.yoYGrossProfit_Q1 < 0 }">  {{ earningReport.yoYGrossProfit_Q1}} </td>

        <td [ngClass]="{ positive: earningReport.qoQNetProfit_Q1 > 0, negative: earningReport.qoQNetProfit_Q1 < 0 }"> {{ earningReport.qoQNetProfit_Q1}} </td>
        <td [ngClass]="{ positive: earningReport.yoYNetProfit_Q1 > 0, negative: earningReport.yoYNetProfit_Q1 < 0 }">  {{ earningReport.yoYNetProfit_Q1}} </td>
        <td class="p-inputgroup">
          <div class="p-grid">
          <button
            pButton
            pRipple
            icon="pi pi-pencil"
            class="p-button-rounded p-button-success p-mr-2 p-col-4"
            (click)="editEarningReport(earningReport)"
          ></button>
        </div>
        </td>

      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog
  [(visible)]="earningReportDialog"
  [style]="{ width: '550px' }"
  header="Earnings Details"
  [modal]="true"
  styleClass="p-fluid"
  [contentStyle]="{'overflow': 'visible'}"
>
  <ng-template pTemplate="content">
    <form [formGroup]="this.formInput">
      <div class="card">
      <div class="p-fluid p-formgrid p-grid">
        <div class="p-field p-col-12 p-md-6">
          <label for="date">Company:</label><br/>
          <input type="text" formControlName="company" required />
        </div>
        <div class="p-field p-col-12 p-md-6">
          <label for="date">Earning Date</label>
          <p-calendar id="date" formControlName="date" [showIcon]="true" inputId="icon" ></p-calendar>
        </div>
     </div>
  </div>
 </form>
  </ng-template>

  <ng-template pTemplate="footer">
    <button
      pButton
      pRipple
      label="Cancel"
      icon="pi pi-times"
      class="p-button-text"
      (click)="hideDialog()"
    ></button>
    <button
      pButton
      pRipple
      label="Save"
      icon="pi pi-check"
      class="p-button-text"
      (click)="saveEarningReport()"
    ></button>
  </ng-template>
</p-dialog>

<p-confirmDialog [style]="{ width: '650px' }"></p-confirmDialog>

<p-toast></p-toast>
<p-progressSpinner *ngIf="loading"></p-progressSpinner>

<div class="row" style="margin-top: 5px">
  <div class="col-md-5">
    <p-breadcrumb [model]="items" [home]="home"></p-breadcrumb>
  </div>
  <div class="col-md-2">
    <p-selectButton [options]="deliveryOptions" [(ngModel)]="deliveryOnly" optionLabel="label" optionValue="value"></p-selectButton>
  </div>

  <div class="col-md-1"><span>Date: </span></div>
  <div class="col-md-2">
    <p-calendar
      [disabledDays]="[0, 6]"
      [(ngModel)]="searchDate"
      [showIcon]="true"
      inputId="icon"
    ></p-calendar>
  </div>
  <div class="col-md-2">
    <p-button (onClick)="searchRecords()" label="Search"></p-button>
  </div>

</div>
<div class="card">
  <p-table
    [value]="deliveries"
    sortField="industry"
    sortMode="single"
    (onSort)="onSort()"
    styleClass="p-datatable-gridlines"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Date</th>
        <th>Symbol</th>
        <th>Sector</th>
        <th>DelRatio</th>
        <th>VolRatio</th>
        <th>Percentage</th>
        <th>Weekly</th>
        <th>Monthly</th>
        <th>Last</th>
        <th>Delivery Qty</th>
        <th>Reason</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-delivery let-rowIndex="rowIndex">
      <tr *ngIf="rowGroupMetadata[delivery.industry].index === rowIndex">
        <td colspan="12" class="industryheader">
          <span class="p-text-bold p-ml-2">{{ delivery.industry }} ({{rowGroupMetadata[delivery.industry].size}})</span>
        </td>
      </tr>
      <tr>
        <td>{{ delivery.date | date: "yyyy-MM-dd" }}</td>
        <td style="cursor: pointer; text-decoration: underline;" (click)= "showStock(delivery.symbolName)">{{ delivery.symbolName }}</td>
        <td>{{ delivery.sector }}</td>
        <td>{{ delivery.delRatio }}</td>
        <td>{{ delivery.volRatio }}</td>
        <td
          [ngClass]="{
            positive: delivery.percentage > 0,
            negative: delivery.percentage < 0
          }"
        >
          {{ delivery.percentage }}%
        </td>

        <td
          [ngClass]="{
            positive: delivery.weekly > 0,
            negative: delivery.weekly < 0
          }"
        >
          {{ delivery.weekly }}%
        </td>
        <td
          [ngClass]="{
            positive: delivery.monthly > 0,
            negative: delivery.monthly < 0
          }"
        >
          {{ delivery.monthly }}%
        </td>

        <td class="right-aligned">
          {{ delivery.last }}
        </td>
        <td class="right-aligned">
          {{ delivery.deliveryQty }}
        </td>
        <td>{{ delivery.reason }}</td>
      </tr>
    </ng-template>
  </p-table>
</div>
